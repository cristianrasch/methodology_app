= content_for :head do
  = javascript_include_tag 'jquery-ui-1.8.12.custom.min', 'jquery.ui.datepicker-es', 'jquery.tokeninput'
  = stylesheet_link_tag 'jquery-ui-1.8.12.custom', 'token-input-facebook'
  :javascript
    $(document).ready(function() {
      $('#project_estimated_start_date').datepicker();
      $('#project_estimated_end_date').datepicker();
      $('#project_envisaged_end_date').datepicker();
      $("#project_user_tokens").tokenInput("#{users_path(:format => :json)}", {
        crossDomain: false,
        prePopulate: $("#project_user_tokens").data("pre"),
        theme: "facebook"
      });
      
      $('#project_estimated_start_date').change(function() {
        $('#project_estimated_end_date').datepicker('setDate', addDaysTo($(this).datepicker('getDate'), 1))
      });
    });

= form.error_messages :header_message => nil, :message => nil

- if @project.new?
  %p
    = form.label :project_name_id
    %br/
    = potential_project_names(ProjectName.arranged)
  
  %p
    = form.label :org_unit_id
    %br/
    = form.collection_select :org_unit_id, OrgUnit.not_roots.with_parent, :id, :to_s, :include_blank => true
  
  %p
    = form.label :klass
    %br/
    = form.select :klass, options_for_select(Project::Klass::SELECT, controller.action_name == 'new' ? nil : @project.klass), 
                  :include_blank => controller.action_name == 'new'
  
  %p
    = form.label :requirement
    %br/
    = form.text_field :requirement, :size => 48
  
  %p
    = form.label :description
    %br/
    = form.text_area :description, :cols => 55, :rows => 5
  
  %table.bottom_spaced{:border => 0, :cellspacing => 0, :cellpadding => 0, :width => "100%"}
    %tr
      %td
        %strong= form.label :dev_id
      %td
        %strong= form.label :owner_id
    %tr
      %td
        = form.collection_select :dev_id, User.devs, :id, :name, :include_blank => true
      %td
        = form.collection_select :owner_id, User.nondevs, :id, :name, :include_blank => true
  
  %p
    = form.label :user_ids
    %br/
    = form.text_field :user_tokens, "data-pre" => @project.users.map(&:attributes).to_json

  %table.bottom_spaced{:border => 0, :cellspacing => 0, :cellpadding => 0, :width => "100%"}
    %thead
      %tr
        %td{:colspan => 3}
          %em EstimaciÃ³n
    %tbody
      %tr
        %td
          %strong= form.label :estimated_start_date
        %td
          %strong= form.label :estimated_end_date
        %td
          %strong= form.label :estimated_duration
      %tr
        %td
          = form.text_field :estimated_start_date, :size => 27, 
                            :value => date_default_value(@project.estimated_start_date)
        %td
          = form.text_field :estimated_end_date, :size => 27, 
                            :value => date_default_value(@project.estimated_end_date)
        %td
          = form.text_field :estimated_duration, :size => 4
          = duration_options_for(@project, :estimated_duration_unit)

- unless @project.finished?
  %table.bottom_spaced{:border => 0, :cellspacing => 0, :cellpadding => 0, :width => "100%"}
    %tr
      %td
        %strong= form.label :compl_perc
      %td
        %strong= form.label :envisaged_end_date
    %tr
      %td
        = form.select :compl_perc, options_for_select((0..10).map {|i| [i*10, i*10]}, @project.compl_perc)
      %td
        = form.text_field :envisaged_end_date, :size => 27, 
                          :value => date_default_value(@project.envisaged_end_date)
